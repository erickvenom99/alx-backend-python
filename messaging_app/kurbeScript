#!/usr/bin/env bash

# File: messaging_app/kurbeScript

## --- Function to Check for Minikube Installation ---
check_minikube() {
    if ! command -v minikube &> /dev/null
    then
        echo "ðŸš¨ ERROR: minikube command could not be found." >&2
        echo "Please ensure minikube is installed and available in your PATH." >&2
        echo "Exiting script." >&2
        exit 1
    else
        echo "âœ… minikube is installed."
    fi
}

## --- Function to Start the Kubernetes Cluster ---
start_cluster() {
    echo "--- 1. Starting local Kubernetes cluster (Minikube)..."
    # The 'minikube start' command initializes and starts a single-node
    # Kubernetes cluster on your machine.
    minikube start
    
    if [ $? -ne 0 ]; then
        echo "ðŸš¨ ERROR: Failed to start minikube cluster." >&2
        exit 1
    fi
    echo "âœ… Minikube cluster start initiated."
}

## --- Function to Verify Cluster Status ---
verify_cluster() {
    echo "--- 2. Verifying cluster status using kubectl cluster-info..."
    # 'kubectl cluster-info' verifies that the Kubernetes API server is reachable.
    kubectl cluster-info
    
    if [ $? -ne 0 ]; then
        echo "ðŸš¨ ERROR: Failed to verify cluster info. kubectl might not be configured correctly." >&2
        exit 1
    fi
    echo "âœ… Cluster connection verified."
}

## --- Function to Retrieve Available Pods ---
get_pods() {
    echo "--- 3. Retrieving available pods in the default namespace..."
    # 'kubectl get pods' lists all pods. This confirms kubectl is working
    # and communicating with the running Minikube cluster.
    kubectl get pods
    echo "âœ… Pod retrieval complete."
}

## --- Main Execution ---
main() {
    check_minikube
    echo ""
    start_cluster
    echo ""
    verify_cluster
    echo ""
    get_pods
    echo ""
    echo "ðŸŽ‰ Kubernetes setup complete for this session!"
}

# Execute the main function
main