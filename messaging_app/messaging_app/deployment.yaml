---
# 1. Deployment Resource: Manages the application pods
apiVersion: apps/v1
kind: Deployment
metadata:
  # Name of the deployment
  name: messaging-app-deployment
  # Apply a common label to this deployment
  labels:
    app: messaging-app
spec:
  # Run 3 replicas of the application for high availability
  replicas: 3
  # Selector to find and manage the pods associated with this deployment
  selector:
    matchLabels:
      app: messaging-app
  # Template defines the pod specification
  template:
    metadata:
      # Labels applied to the pods
      labels:
        app: messaging-app
    spec:
      containers:
      - name: messaging-app-container
        # >>> CRITICAL: REPLACE WITH YOUR ACTUAL IMAGE TAG <<<
        image: your-dockerhub-username/messaging-app:latest
        # Internal port your Django app is running on (from Dockerfile's EXPOSE)
        ports:
        - containerPort: 8000
        # NOTE: Consider adding resource limits and environment variables (for secrets/settings) here

---
# 2. Service Resource: Exposes the deployment internally via ClusterIP
apiVersion: v1
kind: Service
metadata:
  # Name of the service
  name: messaging-app-clusterip-service
spec:
  # Required type: ClusterIP for internal cluster access
  type: ClusterIP
  # Selector matches the 'app: messaging-app' label on the pods
  # This directs traffic to the pods managed by the Deployment
  selector:
    app: messaging-app
  ports:
  - # Port the service itself exposes (internal to the cluster)
    port: 80
    # Port on the target container that the service will forward traffic to
    targetPort: 8000
    # Protocol (optional, but good practice)
    protocol: TCP