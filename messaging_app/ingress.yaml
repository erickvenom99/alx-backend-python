apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: messaging-app-ingress
  annotations:
    # Use the NGINX Ingress Controller
    kubernetes.io/ingress.class: "nginx"
    # This annotation is crucial for Django/Python apps that handle path rewriting.
    # It tells NGINX to strip the path prefix (/api) before forwarding to the service.
    # We will use /api/(.*) in the path and rewrite it to /$1, ensuring the service sees /users instead of /api/users
    nginx.ingress.kubernetes.io/rewrite-target: /$1
spec:
  # The IngressClassName is a standard field now for specifying the controller
  ingressClassName: nginx
  rules:
  - host: your-domain-name.com # <<< IMPORTANT: REPLACE THIS WITH A REAL DOMAIN OR USE A TEST HOSTNAME
    http:
      paths:
      # Rule 1: Match traffic starting with /api/
      - path: /api/(.*)
        pathType: Prefix
        backend:
          service:
            name: messaging-app-clusterip-service
            port:
              number: 80 # The port exposed by your ClusterIP service
      # Rule 2: Match all other traffic (e.g., / or /admin/)
      - path: /(.*)
        pathType: Prefix
        backend:
          service:
            name: messaging-app-clusterip-service
            port:
              number: 80